# Sistema de Estoque - API

Sistema completo de controle de estoque com Node.js, Prisma e PostgreSQL/MySQL.

## Funcionalidades

### Produtos
- âœ… Criar produtos com cÃ³digo personalizado
- âœ… Listar produtos com filtros (cÃ³digo, nome, categoria)
- âœ… Buscar produto por ID ou cÃ³digo
- âœ… Atualizar informaÃ§Ãµes do produto
- âœ… Controle de estoque (adicionar/remover/definir quantidade)
- âœ… Categorias: AcessÃ³rios e Roupas
- âœ… Campos: cÃ³digo, tÃ­tulo, categoria, quantidade, valor unitÃ¡rio, preÃ§o de venda

### Vendas
- âœ… Criar vendas com mÃºltiplos itens
- âœ… Controle automÃ¡tico de estoque nas vendas
- âœ… Status de venda (Pendente, Confirmada, Cancelada, Entregue)
- âœ… Cancelamento com restituiÃ§Ã£o de estoque
- âœ… Filtros por perÃ­odo, status, cliente
- âœ… RelatÃ³rios de vendas

## ğŸ“‹ PrÃ©-requisitos

- Node.js 16+
- PostgreSQL, MySQL ou SQLite
- npm ou yarn

## ğŸ› ï¸ InstalaÃ§Ã£o

1. **Clone o repositÃ³rio**
```bash
git clone <seu-repositorio>
cd sistema-estoque
```

2. **Instale as dependÃªncias**
```bash
npm install
```

3. **Configure o banco de dados**
```bash
# Copie o arquivo de exemplo
cp .env.example .env

# Edite o .env com suas configuraÃ§Ãµes
```

4. **Execute as migraÃ§Ãµes**
```bash
npx prisma migrate dev --name init
```

5. **Popule o banco com dados de exemplo (opcional)**
```bash
npm run prisma:seed
```

6. **Inicie o servidor**
```bash
npm run dev
```

## ğŸ“š Endpoints da API

### Produtos

#### POST /api/produtos
Criar um novo produto
```json
{
  "codigo": "7676",
  "titulo": "Camiseta BÃ¡sica",
  "categoria": "ROUPAS",
  "quantidade": 50,
  "valorUnitario": 15.00,
  "precoVenda": 29.90
}
```

#### GET /api/produtos
Listar produtos com filtros
- `?search=7676` - Busca por cÃ³digo ou tÃ­tulo
- `?categoria=ROUPAS` - Filtro por categoria
- `?page=1&limit=10` - PaginaÃ§Ã£o

#### GET /api/produtos/:id
Buscar produto por ID

#### GET /api/produtos/codigo/:codigo
Buscar produto por cÃ³digo

#### PUT /api/produtos/:id
Atualizar produto
```json
{
  "titulo": "Novo tÃ­tulo",
  "quantidade": 100,
  "precoVenda": 39.90
}
```

#### PATCH /api/produtos/:id/estoque
Atualizar estoque
```json
{
  "quantidade": 10,
  "operacao": "ADD" // ADD, SUBTRACT ou SET
}
```

#### DELETE /api/produtos/:id
Deletar produto

### Vendas

#### POST /api/vendas
Criar nova venda
```json
{
  "codigo": "VEN001",
  "cliente": "JoÃ£o Silva",
  "itens": [
    {
      "produtoId": "uuid-do-produto",
      "quantidade": 2
    }
  ]
}
```

#### GET /api/vendas
Listar vendas com filtros
- `?search=VEN001` - Busca por cÃ³digo ou cliente
- `?status=PENDENTE` - Filtro por status
- `?dataInicio=2025-08-01&dataFim=2025-08-31` - Filtro por perÃ­odo
- `?page=1&limit=10` - PaginaÃ§Ã£o

#### GET /api/vendas/:id
Buscar venda por ID

#### GET /api/vendas/codigo/:codigo
Buscar venda por cÃ³digo

#### PATCH /api/vendas/:id/status
Atualizar status da venda
```json
{
  "status": "CONFIRMADA"
}
```

#### PATCH /api/vendas/:id/cancelar
Cancelar venda (restitui estoque automaticamente)

#### GET /api/vendas/relatorio
RelatÃ³rio de vendas
- `?dataInicio=2025-08-01&dataFim=2025-08-31` - PerÃ­odo

## ğŸ—‚ï¸ Estrutura do Projeto

```
src/
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ produtoController.js
â”‚   â””â”€â”€ vendaController.js
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ produtoRoutes.js
â”‚   â””â”€â”€ vendaRoutes.js
â””â”€â”€ server.js

prisma/
â”œâ”€â”€ schema.prisma
â””â”€â”€ seed.js
```

## ğŸ” Exemplos de Uso

### Criar um produto
```bash
curl -X POST http://localhost:3000/api/produtos \
  -H "Content-Type: application/json" \
  -d '{
    "codigo": "7676",
    "titulo": "Camiseta BÃ¡sica Branca",
    "categoria": "ROUPAS",
    "quantidade": 50,
    "valorUnitario": 15.00,
    "precoVenda": 29.90
  }'
```

### Buscar produtos por cÃ³digo
```bash
curl http://localhost:3000/api/produtos/codigo/7676
```

### Criar uma venda
```bash
curl -X POST http://localhost:3000/api/vendas \
  -H "Content-Type: application/json" \
  -d '{
    "codigo": "VEN001",
    "cliente": "JoÃ£o Silva",
    "itens": [
      {
        "produtoId": "uuid-do-produto",
        "quantidade": 2
      }
    ]
  }'
```

### Filtrar produtos
```bash
# Buscar por cÃ³digo ou tÃ­tulo
curl "http://localhost:3000/api/produtos?search=7676"

# Filtrar por categoria
curl "http://localhost:3000/api/produtos?categoria=ROUPAS"
```

## ğŸ¯ Status Codes

- `200` - Sucesso
- `201` - Criado
- `400` - Erro de validaÃ§Ã£o
- `404` - NÃ£o encontrado
- `500` - Erro interno

## ğŸ›¡ï¸ ValidaÃ§Ãµes

- CÃ³digos Ãºnicos para produtos e vendas
- ValidaÃ§Ã£o de estoque antes das vendas
- ValidaÃ§Ã£o de tipos de dados
- SanitizaÃ§Ã£o de entradas

## ğŸ“Š Funcionalidades AvanÃ§adas

- **TransaÃ§Ãµes**: Vendas usam transaÃ§Ãµes para garantir consistÃªncia
- **PaginaÃ§Ã£o**: Todos os endpoints de listagem suportam paginaÃ§Ã£o
- **Filtros**: Busca flexÃ­vel por cÃ³digo, nome, categoria
- **RelatÃ³rios**: Resumos de vendas por perÃ­odo e status
- **Controle de Estoque**: AtualizaÃ§Ã£o automÃ¡tica nas vendas e cancelamentos

## ğŸš€ Scripts DisponÃ­veis

```bash
npm start          # ProduÃ§Ã£o
npm run dev        # Desenvolvimento
npm run prisma:generate  # Gerar cliente Prisma
npm run prisma:migrate   # Executar migraÃ§Ãµes
npm run prisma:studio    # Interface visual do banco
npm run prisma:seed      # Dados de exemplo
```

## ğŸ“ TODO / Melhorias Futuras

- [ ] Upload de imagens dos produtos
- [ ] HistÃ³rico de movimentaÃ§Ã£o de estoque
- [ ] NotificaÃ§Ãµes de estoque baixo
- [ ] Dashboard administrativo
- [ ] ExportaÃ§Ã£o de relatÃ³rios (PDF/Excel)
- [ ] API de fornecedores
- [ ] CÃ³digo de barras